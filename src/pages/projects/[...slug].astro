---
import ProjectInfo from '@/components/ProjectInfo.astro'
import ProjectLayout from '@/layouts/ProjectLayout.astro'
import type { Project } from '@/types'
import { useStoryblokApi } from '@storyblok/astro'
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro'

export async function getStaticPaths() {
  const sbApi = useStoryblokApi()

  const { data } = await sbApi.get('cdn/stories', {
    content_type: 'project',
    version: import.meta.env.DEV ? 'draft' : 'published'
  })

  const stories = Object.values(data.stories)

  return stories.map((story: any) => {
    return {
      params: { slug: story.slug }
    }
  })
}

const sbApi = useStoryblokApi()
const { slug } = Astro.params
const { data } = await sbApi.get(`cdn/stories/projects/${slug}`, {
  version: import.meta.env.DEV ? 'draft' : 'published'
})

const project: Project = data.story.content
---

<ProjectLayout project={project}>
  <div class="mt-3" slot="project-info">
    <h1 class="mb-6 text-xl font-semibold">{project.name}</h1>
    <img
      src={project.cover.filename}
      alt={project.cover.alt}
      class="aspect-[3/2] max-h-[700px]"
    />
    <div class="my-7 grid grid-cols-1">
      <ProjectInfo name="Location" value={project.location} />
      <ProjectInfo name="Architects" value={project.architects} />
      <ProjectInfo name="Year" value={project.year} />
      <ProjectInfo name="Photographs" value={project.photographs} />
    </div>
  </div>
  <StoryblokComponent blok={project} slot="main-content" />
</ProjectLayout>
